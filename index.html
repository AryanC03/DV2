<!DOCTYPE html>
<html>

<head>
  <!-- Import Vega & Vega-Lite (does not have to be from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>

  <!-- CSS file -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">


</head>

<body>
  <main>
    <div class="card1">
      <h1 style="font-size: 80px;">MAJOR DISASTER EVENTS IN <span
          style="color: rgb(0, 0, 0); font-weight: bold; text-align: center;">AUSTRALIA</span></h1>
      <p style="font-size: smaller; text-align: center; padding-bottom: 1cm">by Aryan Chordia</p>
      <h2 style="text-align: center; font-size: 30px"> <span style="color: rgb(0, 0, 0); font-weight: bold;">NATURAL</span>
        DISASTERS</h2>

      <div>
        <p style="font-style: italic; text-align: center;">The true <span style="color: rgb(0, 0, 0); font-weight: bold;">toll</span> of Australia's worst natural disasters. Bushfires,
          floods, cyclones, storms, and earthquakes.
        </p>
      </div>
      <div id="state-buttons" class="state-button-bar">
        <button type="button" data-state="Australia" class="state-btn active">Australia</button>
        <button type="button" data-state="Australian Capital Territory" class="state-btn">Australian Capital
          Territory</button>
        <button type="button" data-state="New South Wales" class="state-btn">New South Wales</button>
        <button type="button" data-state="Northern Territory" class="state-btn">Northern Territory</button>
        <button type="button" data-state="Queensland" class="state-btn">Queensland</button>
        <button type="button" data-state="South Australia" class="state-btn">South Australia</button>
        <button type="button" data-state="Tasmania" class="state-btn">Tasmania</button>
        <button type="button" data-state="Victoria" class="state-btn">Victoria</button>
        <button type="button" data-state="Western Australia" class="state-btn">Western Australia</button>
      </div>
      <p style="font-size: x-small;">* Pick a state to see further information.</p>
      <div class="row70">

        <div id="symbol_map" class="column70"></div>
        <div id="treemap" class="column70" style="padding-right: 1cm;"></div>
      </div>

      <div>
        <p style="font-size: xx-small;">* Note some states may not align with the states where they are positioned.</p>
      </div>

      <div>
      <h2 style="text-align: center; font-size: 30px">GROSS STATE PRODUCT (GSP) <span style="color: rgb(0, 0, 0); font-weight: bold;">IMPACT</span>
        </h2>
        <p style=" text-align: center; font-style: italic;">Disaster counts spike and crash across states, yet GSP growth rarely falls below zero. Highlighting how <span style="color: black; font-weight: bold;">resilient</span> each economy remains even as extreme events intensify.</p>
      <div id="bar_line_multiples"></div>
      </div>
    </div>

    <div class="card2">
      <h2 style="text-align: center;">Data Sources</h2>
      <p style="font-size: small;"><b>Disaster Data: Australian Disaster Resilience Knowledge Hub</b>
        (https://knowledge.aidr.org.au/resources/data-sources/)</p>
      <p style="font-size: small;"><b>Economic Data: Australian Bureau of Statistics
        </b>(https://www.abs.gov.au/statistics/economy/national-accounts/australian-national-accounts-state-accounts/latest-release#data-downloads)
      </p>
      <p style="font-size: small;"><b>Employment and Unemployment Data: Australia Bureau of Statistics</b>
        (https://www.abs.gov.au/statistics/labour/employment-and-unemployment/labour-force-australia-detailed/latest-release#all-data-downloads)
      </p>
    </div>


  </main>

  <script type="text/javascript">

    var stateButtons = document.querySelectorAll('#state-buttons .state-btn');
    var stateCenters = {
      "Australia": [133, -27],
      "Australian Capital Territory": [149, -35],
      "New South Wales": [147, -31],
      "Northern Territory": [130, -20],
      "Queensland": [153, -28],
      "South Australia": [138, -34],
      "Tasmania": [146, -42],
      "Victoria": [143, -37],
      "Western Australia": [121, -25]
    };
    var barLineSingleStates = [
      "Australian Capital Territory",
      "New South Wales",
      "Northern Territory",
      "Queensland",
      "South Australia",
      "Tasmania",
      "Victoria",
      "Western Australia"
    ];
    var currentState = 'Australia';
    var symbolMapView = null;
    var treemapView = null;
    var barLineSingleView = null;
    var stateTextElement = document.querySelector('.state-text p');

    function setActiveButton(value) {
      stateButtons.forEach(function (btn) {
        var isActive = btn.dataset.state === value;
        btn.classList.toggle('active', isActive);
      });
    }

    function applyStateToMap(value) {
      if (!symbolMapView) {
        return;
      }
      var centre = stateCenters[value] || stateCenters['Australia'];
      symbolMapView.signal('StateFilter', value);
      symbolMapView.signal('centre_to', centre);
      symbolMapView.runAsync();
    }

    function updateStateFromUI(value) {
      currentState = value;
      setActiveButton(value);
      if (treemapView) {
        treemapView.signal('selectedState', value).runAsync();
      }
      if (barLineSingleView && barLineSingleStates.includes(value)) {
        barLineSingleView.signal('selectedState', value).runAsync();
      }
      applyStateToMap(value);

      stateTextElement.textContent = stateDescriptions[value];
    }

    setActiveButton(currentState);

    stateButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        updateStateFromUI(button.dataset.state);
      });
    });


    var spec2 = "js/symbol_map.vg.json";
    vegaEmbed('#symbol_map', spec2).then(function (result) {
      symbolMapView = result.view;
      applyStateToMap(currentState);
    }).catch(console.error);

    var spec3 = "js/treemap.vg.json";
    vegaEmbed('#treemap', spec3).then(function (result) {
      treemapView = result.view;
      treemapView.addSignalListener('selectedState', function (name, value) {
        if (value !== currentState) {
          currentState = value;
          setActiveButton(value);
          applyStateToMap(value);
        }
      });

      if (treemapView.signal('selectedState') !== currentState) {
        treemapView.signal('selectedState', currentState).runAsync();
      }
      setActiveButton(currentState);
      applyStateToMap(currentState);
    }).catch(console.error);

    var spec5 = 'js/bar_line_single.vg.json';
    vegaEmbed('#bar_line_single', spec5).catch(console.error);

    var spec6 = 'js/test_bar_line_mini.vg.json';
    vegaEmbed('#bar_line_multiples', spec6).catch(console.error);

    var spec7 = 'js/bar_line_multiples.vg.json';
    vegaEmbed('#bar_line_multiples2', spec7).catch(console.error);

  </script>

</body>

</html>