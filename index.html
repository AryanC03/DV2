<!DOCTYPE html>
<html>

<head>
  <!-- Import Vega & Vega-Lite (does not have to be from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>

  <!-- CSS file -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">


</head>

<body>
  <main>
    <div>
      <h1>Major Disaster Events in Australia</h1>
    </div>
    <div id="state-buttons" class="state-button-bar">
      <button type="button" data-state="Australia" class="state-btn active">Australia</button>
      <button type="button" data-state="Australian Capital Territory" class="state-btn">Australian Capital
        Territory</button>
      <button type="button" data-state="New South Wales" class="state-btn">New South Wales</button>
      <button type="button" data-state="Northern Territory" class="state-btn">Northern Territory</button>
      <button type="button" data-state="Queensland" class="state-btn">Queensland</button>
      <button type="button" data-state="South Australia" class="state-btn">South Australia</button>
      <button type="button" data-state="Tasmania" class="state-btn">Tasmania</button>
      <button type="button" data-state="Victoria" class="state-btn">Victoria</button>
      <button type="button" data-state="Western Australia" class="state-btn">Western Australia</button>
    </div>
    <div class="row70">
      <div id="symbol_map" class="column70"></div>
      <div id="treemap" class="column70"></div>
    </div>
    <div id="zoom-disaster-buttons">
      <input type="range" class="slider" min="900" max="4000" step="50" id="myRange">
    </div>
    <div class="state-text">
      <p style="text-align: center;"></p>
    </div>
    <div class="row50">
      <div id="bar_line_single" class="column50"></div>
      <p style="padding-left:2cm;">Between 1990 and 2021, Australia experienced an average of around 4 to 5 major disasters per year, while the
        national Gross State Product (GSP) growth averaged about 3.1%. The correlation between disaster frequency and
        GSP growth was weakly positive (r â‰ˆ 0.11), indicating little to no consistent relationship between the two. In
        other words, years with more disasters did not reliably correspond to slower or faster economic growth. Despite
        notable events such as the Black Saturday bushfires in 2009 and the Black Summer fires in 2019-2020, Australia's
        overall economy demonstrated strong resilience, with state-level diversification, such as mining and
        construction activity, often offsetting losses in affected areas.

        Over time, disaster frequency has become more variable, particularly since the 2000s, with bushfires, floods,
        and cyclones occurring more often. However, national GSP growth has remained relatively steady, suggesting that
        while disasters can cause localised and short-term economic disruption, they do not significantly affect the
        country's overall growth trajectory. In some cases, recovery and reconstruction activities may even boost
        economic output in the aftermath of major events. Overall, the data suggests that Australia's economy absorbs
        disaster impacts well on a national scale, though state-level analyses may reveal stronger regional effects.</p>
    </div>

  </main>

  <script type="text/javascript">

    var zoomValue = document.getElementById('myRange');
    zoomValue.value = 1000; // Default zoom level
    zoomValue.addEventListener('input', function () {
      if (symbolMapView) {
        symbolMapView.signal('Zoom', +zoomValue.value).runAsync();
      }
    });

    var stateDescriptions = {};
    fetch('data/descriptions.json').then(response => response.json()).then(data => {
      stateDescriptions = data;
      stateTextElement.textContent = stateDescriptions[currentState];
    })
      .catch(error => console.error('Error loading state descriptions:', error));

    var stateButtons = document.querySelectorAll('#state-buttons .state-btn');
    var stateCenters = {
      "Australia": [133, -27],
      "Australian Capital Territory": [149, -35],
      "New South Wales": [147, -31],
      "Northern Territory": [130, -20],
      "Queensland": [153, -28],
      "South Australia": [138, -34],
      "Tasmania": [146, -42],
      "Victoria": [143, -37],
      "Western Australia": [121, -25]
    };
    var barLineSingleStates = [
      "Australian Capital Territory",
      "New South Wales",
      "Northern Territory",
      "Queensland",
      "South Australia",
      "Tasmania",
      "Victoria",
      "Western Australia"
    ];
    var currentState = 'Australia';
    var symbolMapView = null;
    var treemapView = null;
    var barLineSingleView = null;
    var stateTextElement = document.querySelector('.state-text p');

    function setActiveButton(value) {
      stateButtons.forEach(function (btn) {
        var isActive = btn.dataset.state === value;
        btn.classList.toggle('active', isActive);
      });
    }

    function applyStateToMap(value) {
      if (!symbolMapView) {
        return;
      }
      var centre = stateCenters[value] || stateCenters['Australia'];
      symbolMapView.signal('StateFilter', value);
      symbolMapView.signal('centre_to', centre);
      symbolMapView.runAsync();
    }

    function updateStateFromUI(value) {
      currentState = value;
      setActiveButton(value);
      if (treemapView) {
        treemapView.signal('selectedState', value).runAsync();
      }
      if (barLineSingleView && barLineSingleStates.includes(value)) {
        barLineSingleView.signal('selectedState', value).runAsync();
      }
      applyStateToMap(value);

      stateTextElement.textContent = stateDescriptions[value];
    }

    setActiveButton(currentState);

    stateButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        updateStateFromUI(button.dataset.state);
      });
    });


    var spec2 = "js/symbol_map.vg.json";
    vegaEmbed('#symbol_map', spec2).then(function (result) {
      symbolMapView = result.view;
      applyStateToMap(currentState);
    }).catch(console.error);

    var spec3 = "js/treemap.vg.json";
    vegaEmbed('#treemap', spec3).then(function (result) {
      treemapView = result.view;
      treemapView.addSignalListener('selectedState', function (name, value) {
        if (value !== currentState) {
          currentState = value;
          setActiveButton(value);
          applyStateToMap(value);
        }
      });

      if (treemapView.signal('selectedState') !== currentState) {
        treemapView.signal('selectedState', currentState).runAsync();
      }
      setActiveButton(currentState);
      applyStateToMap(currentState);
    }).catch(console.error);

    // var spec4 = "js/bar_line_multiples.vg.json";
    // vegaEmbed('#bar_line_multiples', spec4).catch(console.error);

    var spec5 = 'js/bar_line_single.vg.json';
    vegaEmbed('#bar_line_single', spec5).catch(console.error);



  </script>

</body>

</html>